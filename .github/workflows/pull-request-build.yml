# When a pull request is created, this action tests that the changes are ready to be merged

name: Check development environment on pull request

on:
  #push:
  #  branches: ["my-test-branch"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: ["ubuntu-latest", "windows-latest", "macos-latest"]

    steps:
      - uses: actions/checkout@v3

      - uses: conda-incubator/setup-miniconda@v2
        with:
          environment-file: environment.yml
          activate-environment: bci

      - name: "Install dependencies"
        shell: bash -el {0}
        run: |
          conda activate bci
          conda info
          pip install .

      - name: "Run smoke tests"
        shell: bash -el {0}
        run: |
          python -m unittest

      - name: "Python black formatting"
        uses: reviewdog/action-black@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          fail_on_error: true

      - name: "flake8 lint"
        uses: reviewdog/action-flake8@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          fail_on_error: true
